<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="VM-specific methods for reference processing, including weak references, and finalizers. We handle weak references and finalizers differently:"><title>ReferenceGlue in mmtk::vm::reference_glue - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceSerif4-Bold-a2c9cd1067f8b328.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../../static.files/rustdoc-f3501f0f5ae15dfb.css" id="mainThemeStyle"><div id="rustdoc-vars" data-root-path="../../../" data-static-root-path="../../../static.files/" data-current-crate="mmtk" data-themes="" data-resource-suffix="" data-rustdoc-version="1.71.1 (eb26296b5 2023-08-03)" data-search-js="search-4926e5fc22a5646a.js" data-settings-js="settings-de11bff964e9d4e5.js" data-settings-css="settings-8c76f75bfb6bd192.css" data-theme-light-css="light-0f8c037637f9eb3e.css" data-theme-dark-css="dark-1097f8e92a01e3cf.css" data-theme-ayu-css="ayu-614652228113ac93.css" ></div><script src="../../../static.files/storage-62ce34ea385b278a.js"></script><script defer src="sidebar-items.js"></script><script defer src="../../../static.files/main-f0540c1d82cde29b.js"></script><noscript><link rel="stylesheet" media="(prefers-color-scheme:light)" href="../../../static.files/light-0f8c037637f9eb3e.css"><link rel="stylesheet" media="(prefers-color-scheme:dark)" href="../../../static.files/dark-1097f8e92a01e3cf.css"><link rel="stylesheet" href="../../../static.files/noscript-13285aec31fa243e.css"></noscript><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc trait"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="logo-container" href="../../../mmtk/index.html"><img class="rust-logo" src="../../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2></h2></nav><nav class="sidebar"><a class="logo-container" href="../../../mmtk/index.html"><img class="rust-logo" src="../../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2 class="location"><a href="#">ReferenceGlue</a></h2><div class="sidebar-elems"><section><h3><a href="#required-associated-types">Required Associated Types</a></h3><ul class="block"><li><a href="#associatedtype.FinalizableType">FinalizableType</a></li></ul><h3><a href="#required-methods">Required Methods</a></h3><ul class="block"><li><a href="#tymethod.enqueue_references">enqueue_references</a></li><li><a href="#tymethod.get_referent">get_referent</a></li><li><a href="#tymethod.set_referent">set_referent</a></li></ul><h3><a href="#provided-methods">Provided Methods</a></h3><ul class="block"><li><a href="#method.clear_referent">clear_referent</a></li><li><a href="#method.is_referent_cleared">is_referent_cleared</a></li></ul><h3><a href="#implementors">Implementors</a></h3></section><h2><a href="index.html">In mmtk::vm::reference_glue</a></h2></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../../../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Trait <a href="../../index.html">mmtk</a>::<wbr><a href="../index.html">vm</a>::<wbr><a href="index.html">reference_glue</a>::<wbr><a class="trait" href="#">ReferenceGlue</a><button id="copy-path" title="Copy item path to clipboard"><img src="../../../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="srclink" href="../../../src/mmtk/vm/reference_glue.rs.html#15-59">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><pre class="rust item-decl"><code>pub trait ReferenceGlue&lt;VM: <a class="trait" href="../trait.VMBinding.html" title="trait mmtk::vm::VMBinding">VMBinding</a>&gt; {
    type <a href="#associatedtype.FinalizableType" class="associatedtype">FinalizableType</a>: <a class="trait" href="trait.Finalizable.html" title="trait mmtk::vm::reference_glue::Finalizable">Finalizable</a>;

    // Required methods
    fn <a href="#tymethod.get_referent" class="fn">get_referent</a>(object: <a class="struct" href="../../util/address/struct.ObjectReference.html" title="struct mmtk::util::address::ObjectReference">ObjectReference</a>) -&gt; <a class="struct" href="../../util/address/struct.ObjectReference.html" title="struct mmtk::util::address::ObjectReference">ObjectReference</a>;
<span class="item-spacer"></span>    fn <a href="#tymethod.set_referent" class="fn">set_referent</a>(reff: <a class="struct" href="../../util/address/struct.ObjectReference.html" title="struct mmtk::util::address::ObjectReference">ObjectReference</a>, referent: <a class="struct" href="../../util/address/struct.ObjectReference.html" title="struct mmtk::util::address::ObjectReference">ObjectReference</a>);
<span class="item-spacer"></span>    fn <a href="#tymethod.enqueue_references" class="fn">enqueue_references</a>(references: &amp;[<a class="struct" href="../../util/address/struct.ObjectReference.html" title="struct mmtk::util::address::ObjectReference">ObjectReference</a>], tls: <a class="struct" href="../../util/opaque_pointer/struct.VMWorkerThread.html" title="struct mmtk::util::opaque_pointer::VMWorkerThread">VMWorkerThread</a>);

    // Provided methods
    fn <a href="#method.clear_referent" class="fn">clear_referent</a>(new_reference: <a class="struct" href="../../util/address/struct.ObjectReference.html" title="struct mmtk::util::address::ObjectReference">ObjectReference</a>) { ... }
<span class="item-spacer"></span>    fn <a href="#method.is_referent_cleared" class="fn">is_referent_cleared</a>(referent: <a class="struct" href="../../util/address/struct.ObjectReference.html" title="struct mmtk::util::address::ObjectReference">ObjectReference</a>) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.71.1/std/primitive.bool.html">bool</a> { ... }
}</code></pre><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>VM-specific methods for reference processing, including weak references, and finalizers.
We handle weak references and finalizers differently:</p>
<ul>
<li>for weak references, we assume they are implemented as normal reference objects (also known as weak objects)
with a referent that is actually weakly reachable. This trait provides a few methods to access
the referent of such an reference object.</li>
<li>for finalizers, we provide a <code>Finalizable</code> trait, and require bindings to specify a type
that implements <code>Finalizable</code>. When the binding registers or pops a finalizable object
from MMTk, the specified type is used for the finalizable objects. For most languages,
they can just use <code>ObjectReference</code> for the finalizable type, meaning that they are registering
and popping a normal object reference as finalizable objects.</li>
</ul>
</div></details><h2 id="required-associated-types" class="small-section-header">Required Associated Types<a href="#required-associated-types" class="anchor">§</a></h2><div class="methods"><details class="toggle" open><summary><section id="associatedtype.FinalizableType" class="method"><a class="srclink rightside" href="../../../src/mmtk/vm/reference_glue.rs.html#17">source</a><h4 class="code-header">type <a href="#associatedtype.FinalizableType" class="associatedtype">FinalizableType</a>: <a class="trait" href="trait.Finalizable.html" title="trait mmtk::vm::reference_glue::Finalizable">Finalizable</a></h4></section></summary><div class="docblock"><p>The type of finalizable objects. This type is used when the binding registers and pops finalizable objects.</p>
</div></details></div><h2 id="required-methods" class="small-section-header">Required Methods<a href="#required-methods" class="anchor">§</a></h2><div class="methods"><details class="toggle method-toggle" open><summary><section id="tymethod.get_referent" class="method"><a class="srclink rightside" href="../../../src/mmtk/vm/reference_glue.rs.html#34">source</a><h4 class="code-header">fn <a href="#tymethod.get_referent" class="fn">get_referent</a>(object: <a class="struct" href="../../util/address/struct.ObjectReference.html" title="struct mmtk::util::address::ObjectReference">ObjectReference</a>) -&gt; <a class="struct" href="../../util/address/struct.ObjectReference.html" title="struct mmtk::util::address::ObjectReference">ObjectReference</a></h4></section></summary><div class="docblock"><p>Get the referent from a weak reference object.</p>
<p>Arguments:</p>
<ul>
<li><code>object</code>: The object reference.</li>
</ul>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.set_referent" class="method"><a class="srclink rightside" href="../../../src/mmtk/vm/reference_glue.rs.html#41">source</a><h4 class="code-header">fn <a href="#tymethod.set_referent" class="fn">set_referent</a>(reff: <a class="struct" href="../../util/address/struct.ObjectReference.html" title="struct mmtk::util::address::ObjectReference">ObjectReference</a>, referent: <a class="struct" href="../../util/address/struct.ObjectReference.html" title="struct mmtk::util::address::ObjectReference">ObjectReference</a>)</h4></section></summary><div class="docblock"><p>Set the referent in a weak reference object.</p>
<p>Arguments:</p>
<ul>
<li><code>reff</code>: The object reference for the reference.</li>
<li><code>referent</code>: The referent object reference.</li>
</ul>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.enqueue_references" class="method"><a class="srclink rightside" href="../../../src/mmtk/vm/reference_glue.rs.html#58">source</a><h4 class="code-header">fn <a href="#tymethod.enqueue_references" class="fn">enqueue_references</a>(references: &amp;[<a class="struct" href="../../util/address/struct.ObjectReference.html" title="struct mmtk::util::address::ObjectReference">ObjectReference</a>], tls: <a class="struct" href="../../util/opaque_pointer/struct.VMWorkerThread.html" title="struct mmtk::util::opaque_pointer::VMWorkerThread">VMWorkerThread</a>)</h4></section></summary><div class="docblock"><p>For weak reference types, if the referent is cleared during GC, the reference
will be added to a queue, and MMTk will call this method to inform
the VM about the changes for those references. This method is used
to implement Java’s ReferenceQueue.
Note that this method is called for each type of weak references during GC, and
the references slice will be cleared after this call is returned. That means
MMTk will no longer keep these references alive once this method is returned.</p>
</div></details></div><h2 id="provided-methods" class="small-section-header">Provided Methods<a href="#provided-methods" class="anchor">§</a></h2><div class="methods"><details class="toggle method-toggle" open><summary><section id="method.clear_referent" class="method"><a class="srclink rightside" href="../../../src/mmtk/vm/reference_glue.rs.html#26-28">source</a><h4 class="code-header">fn <a href="#method.clear_referent" class="fn">clear_referent</a>(new_reference: <a class="struct" href="../../util/address/struct.ObjectReference.html" title="struct mmtk::util::address::ObjectReference">ObjectReference</a>)</h4></section></summary><div class="docblock"><p>Weak and soft references always clear the referent
before enqueueing.</p>
<p>Arguments:</p>
<ul>
<li><code>new_reference</code>: The reference whose referent is to be cleared.</li>
</ul>
</div></details><details class="toggle method-toggle" open><summary><section id="method.is_referent_cleared" class="method"><a class="srclink rightside" href="../../../src/mmtk/vm/reference_glue.rs.html#47-49">source</a><h4 class="code-header">fn <a href="#method.is_referent_cleared" class="fn">is_referent_cleared</a>(referent: <a class="struct" href="../../util/address/struct.ObjectReference.html" title="struct mmtk::util::address::ObjectReference">ObjectReference</a>) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.71.1/std/primitive.bool.html">bool</a></h4></section></summary><div class="docblock"><p>Check if the referent has been cleared.</p>
<p>Arguments:</p>
<ul>
<li><code>referent</code>: The referent object reference.</li>
</ul>
</div></details></div><h2 id="implementors" class="small-section-header">Implementors<a href="#implementors" class="anchor">§</a></h2><div id="implementors-list"></div><script src="../../../implementors/mmtk/vm/reference_glue/trait.ReferenceGlue.js" async></script></section></div></main></body></html>