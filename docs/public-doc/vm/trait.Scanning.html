<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="VM-specific methods for scanning roots&#x2F;objects."><meta name="keywords" content="rust, rustlang, rust-lang, Scanning"><title>Scanning in mmtk::vm - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceSerif4-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../FiraSans-Regular.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../FiraSans-Medium.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceCodePro-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceSerif4-Bold.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceCodePro-Semibold.ttf.woff2"><link rel="stylesheet" type="text/css" href="../../normalize.css"><link rel="stylesheet" type="text/css" href="../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../../ayu.css" disabled><link rel="stylesheet" type="text/css" href="../../dark.css" disabled><link rel="stylesheet" type="text/css" href="../../light.css" id="themeStyle"><script id="default-settings" ></script><script src="../../storage.js"></script><script src="../../crates.js"></script><script defer src="../../main.js"></script>
    <noscript><link rel="stylesheet" href="../../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../../favicon.svg"></head><body class="rustdoc trait"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu" role="button">&#9776;</div><a class="sidebar-logo" href="../../mmtk/index.html"><div class="logo-container"><img class="rust-logo" src="../../rust-logo.png" alt="logo"></div>
        </a><h2 class="location">Trait Scanning</h2><div class="sidebar-elems"><div class="block items"><h3 class="sidebar-title"><a href="#associated-const">Associated Constants</a></h3><div class="sidebar-links"><a href="#associatedconstant.SCAN_MUTATORS_IN_SAFEPOINT">SCAN_MUTATORS_IN_SAFEPOINT</a><a href="#associatedconstant.SINGLE_THREAD_MUTATOR_SCANNING">SINGLE_THREAD_MUTATOR_SCANNING</a></div><h3 class="sidebar-title"><a href="#required-methods">Required Methods</a></h3><div class="sidebar-links"><a href="#tymethod.notify_initial_thread_scan_complete">notify_initial_thread_scan_complete</a><a href="#tymethod.prepare_for_roots_re_scanning">prepare_for_roots_re_scanning</a><a href="#tymethod.scan_object">scan_object</a><a href="#tymethod.scan_thread_root">scan_thread_root</a><a href="#tymethod.scan_thread_roots">scan_thread_roots</a><a href="#tymethod.scan_vm_specific_roots">scan_vm_specific_roots</a><a href="#tymethod.supports_return_barrier">supports_return_barrier</a></div><h3 class="sidebar-title"><a href="#provided-methods">Provided Methods</a></h3><div class="sidebar-links"><a href="#method.forward_weak_refs">forward_weak_refs</a><a href="#method.process_weak_refs">process_weak_refs</a><a href="#method.scan_object_and_trace_edges">scan_object_and_trace_edges</a><a href="#method.support_edge_enqueuing">support_edge_enqueuing</a></div><h3 class="sidebar-title"><a href="#implementors">Implementors</a></h3></div><h2 class="location">Other items in<br><a href="../index.html">mmtk</a>::<wbr><a href="index.html">vm</a></h2><div id="sidebar-vars" data-name="Scanning" data-ty="trait" data-relpath=""></div><script defer src="sidebar-items.js"></script></div></nav><main><div class="width-limiter"><div class="sub-container"><a class="sub-logo-container" href="../../mmtk/index.html"><img class="rust-logo" src="../../rust-logo.png" alt="logo"></a><nav class="sub"><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu" title="themes"><img width="18" height="18" alt="Pick another theme!" src="../../brush.svg"></button><div id="theme-choices" role="menu"></div></div><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><button type="button" id="help-button" title="help">?</button><a id="settings-menu" href="../../settings.html" title="settings"><img width="18" height="18" alt="Change settings" src="../../wheel.svg"></a></div></form></nav></div><section id="main-content" class="content"><h1 class="fqn"><span class="in-band">Trait <a href="../index.html">mmtk</a>::<wbr><a href="index.html">vm</a>::<wbr><a class="trait" href="#">Scanning</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span><span class="out-of-band"><span id="render-detail"><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span><a class="srclink" href="../../src/mmtk/vm/scanning.rs.html#117-290" title="goto source code">[src]</a></span></h1><div class="docblock item-decl"><pre class="rust trait"><code>pub trait Scanning&lt;VM:&nbsp;<a class="trait" href="trait.VMBinding.html" title="trait mmtk::vm::VMBinding">VMBinding</a>&gt; {
    const <a href="#associatedconstant.SCAN_MUTATORS_IN_SAFEPOINT" class="constant">SCAN_MUTATORS_IN_SAFEPOINT</a>: <a class="primitive" href="https://doc.rust-lang.org/1.59.0/std/primitive.bool.html">bool</a>;
    const <a href="#associatedconstant.SINGLE_THREAD_MUTATOR_SCANNING" class="constant">SINGLE_THREAD_MUTATOR_SCANNING</a>: <a class="primitive" href="https://doc.rust-lang.org/1.59.0/std/primitive.bool.html">bool</a>;

    fn <a href="#tymethod.scan_object" class="fnname">scan_object</a>&lt;EV:&nbsp;<a class="trait" href="trait.EdgeVisitor.html" title="trait mmtk::vm::EdgeVisitor">EdgeVisitor</a>&lt;VM::<a class="associatedtype" href="trait.VMBinding.html#associatedtype.VMEdge" title="type mmtk::vm::VMBinding::VMEdge">VMEdge</a>&gt;&gt;(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tls: <a class="struct" href="../util/opaque_pointer/struct.VMWorkerThread.html" title="struct mmtk::util::opaque_pointer::VMWorkerThread">VMWorkerThread</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;object: <a class="struct" href="../util/address/struct.ObjectReference.html" title="struct mmtk::util::address::ObjectReference">ObjectReference</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;edge_visitor: <a class="primitive" href="https://doc.rust-lang.org/1.59.0/std/primitive.reference.html">&amp;mut </a>EV<br>&nbsp;&nbsp;&nbsp;&nbsp;);
<div class="item-spacer"></div>    fn <a href="#tymethod.notify_initial_thread_scan_complete" class="fnname">notify_initial_thread_scan_complete</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;partial_scan: <a class="primitive" href="https://doc.rust-lang.org/1.59.0/std/primitive.bool.html">bool</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tls: <a class="struct" href="../util/opaque_pointer/struct.VMWorkerThread.html" title="struct mmtk::util::opaque_pointer::VMWorkerThread">VMWorkerThread</a><br>&nbsp;&nbsp;&nbsp;&nbsp;);
<div class="item-spacer"></div>    fn <a href="#tymethod.scan_thread_roots" class="fnname">scan_thread_roots</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tls: <a class="struct" href="../util/opaque_pointer/struct.VMWorkerThread.html" title="struct mmtk::util::opaque_pointer::VMWorkerThread">VMWorkerThread</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;factory: impl <a class="trait" href="trait.RootsWorkFactory.html" title="trait mmtk::vm::RootsWorkFactory">RootsWorkFactory</a>&lt;VM::<a class="associatedtype" href="trait.VMBinding.html#associatedtype.VMEdge" title="type mmtk::vm::VMBinding::VMEdge">VMEdge</a>&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;);
<div class="item-spacer"></div>    fn <a href="#tymethod.scan_thread_root" class="fnname">scan_thread_root</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tls: <a class="struct" href="../util/opaque_pointer/struct.VMWorkerThread.html" title="struct mmtk::util::opaque_pointer::VMWorkerThread">VMWorkerThread</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mutator: &amp;'static mut <a class="struct" href="../plan/struct.Mutator.html" title="struct mmtk::plan::Mutator">Mutator</a>&lt;VM&gt;, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;factory: impl <a class="trait" href="trait.RootsWorkFactory.html" title="trait mmtk::vm::RootsWorkFactory">RootsWorkFactory</a>&lt;VM::<a class="associatedtype" href="trait.VMBinding.html#associatedtype.VMEdge" title="type mmtk::vm::VMBinding::VMEdge">VMEdge</a>&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;);
<div class="item-spacer"></div>    fn <a href="#tymethod.scan_vm_specific_roots" class="fnname">scan_vm_specific_roots</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tls: <a class="struct" href="../util/opaque_pointer/struct.VMWorkerThread.html" title="struct mmtk::util::opaque_pointer::VMWorkerThread">VMWorkerThread</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;factory: impl <a class="trait" href="trait.RootsWorkFactory.html" title="trait mmtk::vm::RootsWorkFactory">RootsWorkFactory</a>&lt;VM::<a class="associatedtype" href="trait.VMBinding.html#associatedtype.VMEdge" title="type mmtk::vm::VMBinding::VMEdge">VMEdge</a>&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;);
<div class="item-spacer"></div>    fn <a href="#tymethod.supports_return_barrier" class="fnname">supports_return_barrier</a>() -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.59.0/std/primitive.bool.html">bool</a>;
<div class="item-spacer"></div>    fn <a href="#tymethod.prepare_for_roots_re_scanning" class="fnname">prepare_for_roots_re_scanning</a>();

    fn <a href="#method.support_edge_enqueuing" class="fnname">support_edge_enqueuing</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_tls: <a class="struct" href="../util/opaque_pointer/struct.VMWorkerThread.html" title="struct mmtk::util::opaque_pointer::VMWorkerThread">VMWorkerThread</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_object: <a class="struct" href="../util/address/struct.ObjectReference.html" title="struct mmtk::util::address::ObjectReference">ObjectReference</a><br>&nbsp;&nbsp;&nbsp;&nbsp;) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.59.0/std/primitive.bool.html">bool</a> { ... }
<div class="item-spacer"></div>    fn <a href="#method.scan_object_and_trace_edges" class="fnname">scan_object_and_trace_edges</a>&lt;OT:&nbsp;<a class="trait" href="trait.ObjectTracer.html" title="trait mmtk::vm::ObjectTracer">ObjectTracer</a>&gt;(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_tls: <a class="struct" href="../util/opaque_pointer/struct.VMWorkerThread.html" title="struct mmtk::util::opaque_pointer::VMWorkerThread">VMWorkerThread</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_object: <a class="struct" href="../util/address/struct.ObjectReference.html" title="struct mmtk::util::address::ObjectReference">ObjectReference</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_object_tracer: <a class="primitive" href="https://doc.rust-lang.org/1.59.0/std/primitive.reference.html">&amp;mut </a>OT<br>&nbsp;&nbsp;&nbsp;&nbsp;) { ... }
<div class="item-spacer"></div>    fn <a href="#method.process_weak_refs" class="fnname">process_weak_refs</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_worker: &amp;mut <a class="struct" href="../scheduler/struct.GCWorker.html" title="struct mmtk::scheduler::GCWorker">GCWorker</a>&lt;VM&gt;, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_tracer_context: impl <a class="trait" href="trait.ObjectTracerContext.html" title="trait mmtk::vm::ObjectTracerContext">ObjectTracerContext</a>&lt;VM&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.59.0/std/primitive.bool.html">bool</a> { ... }
<div class="item-spacer"></div>    fn <a href="#method.forward_weak_refs" class="fnname">forward_weak_refs</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_worker: &amp;mut <a class="struct" href="../scheduler/struct.GCWorker.html" title="struct mmtk::scheduler::GCWorker">GCWorker</a>&lt;VM&gt;, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_tracer_context: impl <a class="trait" href="trait.ObjectTracerContext.html" title="trait mmtk::vm::ObjectTracerContext">ObjectTracerContext</a>&lt;VM&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;) { ... }
}</code></pre></div><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>VM-specific methods for scanning roots/objects.</p>
</div></details><h2 id="associated-const" class="small-section-header">Associated Constants<a href="#associated-const" class="anchor"></a></h2><div class="methods"><details class="rustdoc-toggle" open><summary><div id="associatedconstant.SCAN_MUTATORS_IN_SAFEPOINT" class="method has-srclink"><div class="rightside"><a class="srclink" href="../../src/mmtk/vm/scanning.rs.html#119" title="goto source code">[src]</a></div><h4 class="code-header">const <a href="#associatedconstant.SCAN_MUTATORS_IN_SAFEPOINT" class="constant">SCAN_MUTATORS_IN_SAFEPOINT</a>: <a class="primitive" href="https://doc.rust-lang.org/1.59.0/std/primitive.bool.html">bool</a></h4></div></summary><div class="docblock"><p>Scan stack roots after all mutators are paused.</p>
</div></details><details class="rustdoc-toggle" open><summary><div id="associatedconstant.SINGLE_THREAD_MUTATOR_SCANNING" class="method has-srclink"><div class="rightside"><a class="srclink" href="../../src/mmtk/vm/scanning.rs.html#124" title="goto source code">[src]</a></div><h4 class="code-header">const <a href="#associatedconstant.SINGLE_THREAD_MUTATOR_SCANNING" class="constant">SINGLE_THREAD_MUTATOR_SCANNING</a>: <a class="primitive" href="https://doc.rust-lang.org/1.59.0/std/primitive.bool.html">bool</a></h4></div></summary><div class="docblock"><p>Scan all the mutators within a single work packet.</p>
<p><code>SCAN_MUTATORS_IN_SAFEPOINT</code> should also be enabled</p>
</div></details></div><h2 id="required-methods" class="small-section-header">Required methods<a href="#required-methods" class="anchor"></a></h2><div class="methods"><details class="rustdoc-toggle" open><summary><div id="tymethod.scan_object" class="method has-srclink"><div class="rightside"><a class="srclink" href="../../src/mmtk/vm/scanning.rs.html#155-159" title="goto source code">[src]</a></div><h4 class="code-header">fn <a href="#tymethod.scan_object" class="fnname">scan_object</a>&lt;EV:&nbsp;<a class="trait" href="trait.EdgeVisitor.html" title="trait mmtk::vm::EdgeVisitor">EdgeVisitor</a>&lt;VM::<a class="associatedtype" href="trait.VMBinding.html#associatedtype.VMEdge" title="type mmtk::vm::VMBinding::VMEdge">VMEdge</a>&gt;&gt;(<br>&nbsp;&nbsp;&nbsp;&nbsp;tls: <a class="struct" href="../util/opaque_pointer/struct.VMWorkerThread.html" title="struct mmtk::util::opaque_pointer::VMWorkerThread">VMWorkerThread</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;object: <a class="struct" href="../util/address/struct.ObjectReference.html" title="struct mmtk::util::address::ObjectReference">ObjectReference</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;edge_visitor: <a class="primitive" href="https://doc.rust-lang.org/1.59.0/std/primitive.reference.html">&amp;mut </a>EV<br>)</h4></div></summary><div class="docblock"><p>Delegated scanning of a object, visiting each reference field encountered.</p>
<p>The VM shall call <code>edge_visitor.visit_edge</code> on each reference field.</p>
<p>The VM may skip a reference field if it holds a null reference.  If the VM supports tagged
references, it must skip tagged reference fields which are not holding references.</p>
<p>Arguments:</p>
<ul>
<li><code>tls</code>: The VM-specific thread-local storage for the current worker.</li>
<li><code>object</code>: The object to be scanned.</li>
<li><code>edge_visitor</code>: Called back for each edge.</li>
</ul>
</div></details><details class="rustdoc-toggle" open><summary><div id="tymethod.notify_initial_thread_scan_complete" class="method has-srclink"><div class="rightside"><a class="srclink" href="../../src/mmtk/vm/scanning.rs.html#191" title="goto source code">[src]</a></div><h4 class="code-header">fn <a href="#tymethod.notify_initial_thread_scan_complete" class="fnname">notify_initial_thread_scan_complete</a>(partial_scan: <a class="primitive" href="https://doc.rust-lang.org/1.59.0/std/primitive.bool.html">bool</a>, tls: <a class="struct" href="../util/opaque_pointer/struct.VMWorkerThread.html" title="struct mmtk::util::opaque_pointer::VMWorkerThread">VMWorkerThread</a>)</h4></div></summary><div class="docblock"><p>MMTk calls this method at the first time during a collection that thread’s stacks
have been scanned. This can be used (for example) to clean up
obsolete compiled methods that are no longer being executed.</p>
<p>Arguments:</p>
<ul>
<li><code>partial_scan</code>: Whether the scan was partial or full-heap.</li>
<li><code>tls</code>: The GC thread that is performing the thread scan.</li>
</ul>
</div></details><details class="rustdoc-toggle" open><summary><div id="tymethod.scan_thread_roots" class="method has-srclink"><div class="rightside"><a class="srclink" href="../../src/mmtk/vm/scanning.rs.html#198" title="goto source code">[src]</a></div><h4 class="code-header">fn <a href="#tymethod.scan_thread_roots" class="fnname">scan_thread_roots</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;tls: <a class="struct" href="../util/opaque_pointer/struct.VMWorkerThread.html" title="struct mmtk::util::opaque_pointer::VMWorkerThread">VMWorkerThread</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;factory: impl <a class="trait" href="trait.RootsWorkFactory.html" title="trait mmtk::vm::RootsWorkFactory">RootsWorkFactory</a>&lt;VM::<a class="associatedtype" href="trait.VMBinding.html#associatedtype.VMEdge" title="type mmtk::vm::VMBinding::VMEdge">VMEdge</a>&gt;<br>)</h4></div></summary><div class="docblock"><p>Scan all the mutators for roots.</p>
<p>Arguments:</p>
<ul>
<li><code>tls</code>: The GC thread that is performing this scanning.</li>
<li><code>factory</code>: The VM uses it to create work packets for scanning roots.</li>
</ul>
</div></details><details class="rustdoc-toggle" open><summary><div id="tymethod.scan_thread_root" class="method has-srclink"><div class="rightside"><a class="srclink" href="../../src/mmtk/vm/scanning.rs.html#206-210" title="goto source code">[src]</a></div><h4 class="code-header">fn <a href="#tymethod.scan_thread_root" class="fnname">scan_thread_root</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;tls: <a class="struct" href="../util/opaque_pointer/struct.VMWorkerThread.html" title="struct mmtk::util::opaque_pointer::VMWorkerThread">VMWorkerThread</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;mutator: &amp;'static mut <a class="struct" href="../plan/struct.Mutator.html" title="struct mmtk::plan::Mutator">Mutator</a>&lt;VM&gt;, <br>&nbsp;&nbsp;&nbsp;&nbsp;factory: impl <a class="trait" href="trait.RootsWorkFactory.html" title="trait mmtk::vm::RootsWorkFactory">RootsWorkFactory</a>&lt;VM::<a class="associatedtype" href="trait.VMBinding.html#associatedtype.VMEdge" title="type mmtk::vm::VMBinding::VMEdge">VMEdge</a>&gt;<br>)</h4></div></summary><div class="docblock"><p>Scan one mutator for roots.</p>
<p>Arguments:</p>
<ul>
<li><code>tls</code>: The GC thread that is performing this scanning.</li>
<li><code>mutator</code>: The reference to the mutator whose roots will be scanned.</li>
<li><code>factory</code>: The VM uses it to create work packets for scanning roots.</li>
</ul>
</div></details><details class="rustdoc-toggle" open><summary><div id="tymethod.scan_vm_specific_roots" class="method has-srclink"><div class="rightside"><a class="srclink" href="../../src/mmtk/vm/scanning.rs.html#218" title="goto source code">[src]</a></div><h4 class="code-header">fn <a href="#tymethod.scan_vm_specific_roots" class="fnname">scan_vm_specific_roots</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;tls: <a class="struct" href="../util/opaque_pointer/struct.VMWorkerThread.html" title="struct mmtk::util::opaque_pointer::VMWorkerThread">VMWorkerThread</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;factory: impl <a class="trait" href="trait.RootsWorkFactory.html" title="trait mmtk::vm::RootsWorkFactory">RootsWorkFactory</a>&lt;VM::<a class="associatedtype" href="trait.VMBinding.html#associatedtype.VMEdge" title="type mmtk::vm::VMBinding::VMEdge">VMEdge</a>&gt;<br>)</h4></div></summary><div class="docblock"><p>Scan VM-specific roots. The creation of all root scan tasks (except thread scanning)
goes here.</p>
<p>Arguments:</p>
<ul>
<li><code>tls</code>: The GC thread that is performing this scanning.</li>
<li><code>factory</code>: The VM uses it to create work packets for scanning roots.</li>
</ul>
</div></details><details class="rustdoc-toggle" open><summary><div id="tymethod.supports_return_barrier" class="method has-srclink"><div class="rightside"><a class="srclink" href="../../src/mmtk/vm/scanning.rs.html#221" title="goto source code">[src]</a></div><h4 class="code-header">fn <a href="#tymethod.supports_return_barrier" class="fnname">supports_return_barrier</a>() -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.59.0/std/primitive.bool.html">bool</a></h4></div></summary><div class="docblock"><p>Return whether the VM supports return barriers. This is unused at the moment.</p>
</div></details><div id="tymethod.prepare_for_roots_re_scanning" class="method has-srclink"><div class="rightside"><a class="srclink" href="../../src/mmtk/vm/scanning.rs.html#223" title="goto source code">[src]</a></div><h4 class="code-header">fn <a href="#tymethod.prepare_for_roots_re_scanning" class="fnname">prepare_for_roots_re_scanning</a>()</h4></div></div><h2 id="provided-methods" class="small-section-header">Provided methods<a href="#provided-methods" class="anchor"></a></h2><div class="methods"><details class="rustdoc-toggle" open><summary><div id="method.support_edge_enqueuing" class="method has-srclink"><div class="rightside"><a class="srclink" href="../../src/mmtk/vm/scanning.rs.html#140-142" title="goto source code">[src]</a></div><h4 class="code-header">fn <a href="#method.support_edge_enqueuing" class="fnname">support_edge_enqueuing</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;_tls: <a class="struct" href="../util/opaque_pointer/struct.VMWorkerThread.html" title="struct mmtk::util::opaque_pointer::VMWorkerThread">VMWorkerThread</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;_object: <a class="struct" href="../util/address/struct.ObjectReference.html" title="struct mmtk::util::address::ObjectReference">ObjectReference</a><br>) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.59.0/std/primitive.bool.html">bool</a></h4></div></summary><div class="docblock"><p>Return true if the given object supports edge enqueuing.</p>
<ul>
<li>If this returns true, MMTk core will call <code>scan_object</code> on the object.</li>
<li>Otherwise, MMTk core will call <code>scan_object_and_trace_edges</code> on the object.</li>
</ul>
<p>For maximum performance, the VM should support edge-enqueuing for as many objects as
practical.  Also note that this method is called for every object to be scanned, so it
must be fast.  The VM binding should avoid expensive checks and keep it as efficient as
possible.  Add <code>#[inline(always)]</code> to ensure it is inlined.</p>
<p>Arguments:</p>
<ul>
<li><code>tls</code>: The VM-specific thread-local storage for the current worker.</li>
<li><code>object</code>: The object to be scanned.</li>
</ul>
</div></details><details class="rustdoc-toggle" open><summary><div id="method.scan_object_and_trace_edges" class="method has-srclink"><div class="rightside"><a class="srclink" href="../../src/mmtk/vm/scanning.rs.html#176-182" title="goto source code">[src]</a></div><h4 class="code-header">fn <a href="#method.scan_object_and_trace_edges" class="fnname">scan_object_and_trace_edges</a>&lt;OT:&nbsp;<a class="trait" href="trait.ObjectTracer.html" title="trait mmtk::vm::ObjectTracer">ObjectTracer</a>&gt;(<br>&nbsp;&nbsp;&nbsp;&nbsp;_tls: <a class="struct" href="../util/opaque_pointer/struct.VMWorkerThread.html" title="struct mmtk::util::opaque_pointer::VMWorkerThread">VMWorkerThread</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;_object: <a class="struct" href="../util/address/struct.ObjectReference.html" title="struct mmtk::util::address::ObjectReference">ObjectReference</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;_object_tracer: <a class="primitive" href="https://doc.rust-lang.org/1.59.0/std/primitive.reference.html">&amp;mut </a>OT<br>)</h4></div></summary><div class="docblock"><p>Delegated scanning of a object, visiting each reference field encountered, and trace the
objects pointed by each field.</p>
<p>The VM shall call <code>object_tracer.trace_object</code> on the value held in each reference field,
and assign the returned value back to the field.  If the VM uses tagged references, the
value passed to <code>object_tracer.trace_object</code> shall be the <code>ObjectReference</code> to the object
without any tag bits.</p>
<p>The VM may skip a reference field if it holds a null reference.  If the VM supports tagged
references, it must skip tagged reference fields which are not holding references.</p>
<p>Arguments:</p>
<ul>
<li><code>tls</code>: The VM-specific thread-local storage for the current worker.</li>
<li><code>object</code>: The object to be scanned.</li>
<li><code>object_tracer</code>: Called back for the content of each edge.</li>
</ul>
</div></details><details class="rustdoc-toggle" open><summary><div id="method.process_weak_refs" class="method has-srclink"><div class="rightside"><a class="srclink" href="../../src/mmtk/vm/scanning.rs.html#268-273" title="goto source code">[src]</a></div><h4 class="code-header">fn <a href="#method.process_weak_refs" class="fnname">process_weak_refs</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;_worker: &amp;mut <a class="struct" href="../scheduler/struct.GCWorker.html" title="struct mmtk::scheduler::GCWorker">GCWorker</a>&lt;VM&gt;, <br>&nbsp;&nbsp;&nbsp;&nbsp;_tracer_context: impl <a class="trait" href="trait.ObjectTracerContext.html" title="trait mmtk::vm::ObjectTracerContext">ObjectTracerContext</a>&lt;VM&gt;<br>) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.59.0/std/primitive.bool.html">bool</a></h4></div></summary><div class="docblock"><p>Process weak references.</p>
<p>This function is called after a transitive closure is completed.</p>
<p>MMTk core enables the VM binding to do the following in this function:</p>
<ol>
<li>Query if an object is already reached in this transitive closure.</li>
<li>Keep certain objects and their descendents alive.</li>
<li>Get the new address of objects that are either
<ul>
<li>already alive before this function is called, or</li>
<li>explicitly kept alive in this function.</li>
</ul>
</li>
<li>Request this function to be called again after transitive closure is finished again.</li>
</ol>
<p>The VM binding can call <code>ObjectReference::is_reachable()</code> to query if an object is
currently reached.</p>
<p>The VM binding can use <code>tracer_factory</code> to get access to an <code>ObjectTracer</code>, and call
its <code>trace_object(object)</code> method to keep <code>object</code> and its decendents alive.</p>
<p>The return value of <code>ObjectTracer::trace_object(object)</code> is the new address of the given
<code>object</code> if it is moved by the GC.</p>
<p>The VM binding can return <code>true</code> from <code>process_weak_refs</code> to request <code>process_weak_refs</code>
to be called again after the MMTk core finishes transitive closure again from the objects
newly visited by <code>ObjectTracer::trace_object</code>.  This is useful if a VM supports multiple
levels of reachabilities (such as Java) or ephemerons.</p>
<p>Implementation-wise, this function is called as the “sentinel” of the <code>VMRefClosure</code> work
bucket, which means it is called when all work packets in that bucket have finished.  The
<code>tracer_factory</code> expands the transitive closure by adding more work packets in the same
bucket.  This means if <code>process_weak_refs</code> returns true, those work packets will have
finished (completing the transitive closure) by the time <code>process_weak_refs</code> is called
again.  The VM binding can make use of this by adding custom work packets into the
<code>VMRefClosure</code> bucket.  The bucket will be <code>VMRefForwarding</code>, instead, when forwarding.
See below.</p>
<p>Arguments:</p>
<ul>
<li><code>worker</code>: The current GC worker.</li>
<li><code>tracer_context</code>: Use this to get access an <code>ObjectTracer</code> and use it to retain and
update weak references.</li>
</ul>
<p>This function shall return true if this function needs to be called again after the GC
finishes expanding the transitive closure from the objects kept alive.</p>
</div></details><details class="rustdoc-toggle" open><summary><div id="method.forward_weak_refs" class="method has-srclink"><div class="rightside"><a class="srclink" href="../../src/mmtk/vm/scanning.rs.html#285-289" title="goto source code">[src]</a></div><h4 class="code-header">fn <a href="#method.forward_weak_refs" class="fnname">forward_weak_refs</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;_worker: &amp;mut <a class="struct" href="../scheduler/struct.GCWorker.html" title="struct mmtk::scheduler::GCWorker">GCWorker</a>&lt;VM&gt;, <br>&nbsp;&nbsp;&nbsp;&nbsp;_tracer_context: impl <a class="trait" href="trait.ObjectTracerContext.html" title="trait mmtk::vm::ObjectTracerContext">ObjectTracerContext</a>&lt;VM&gt;<br>)</h4></div></summary><div class="docblock"><p>Forward weak references.</p>
<p>This function will only be called in the forwarding stage when using the mark-compact GC
algorithm.  Mark-compact computes transive closure twice during each GC.  It marks objects
in the first transitive closure, and forward references in the second transitive closure.</p>
<p>Arguments:</p>
<ul>
<li><code>worker</code>: The current GC worker.</li>
<li><code>tracer_context</code>: Use this to get access an <code>ObjectTracer</code> and use it to update weak
references.</li>
</ul>
</div></details></div><h2 id="implementors" class="small-section-header">Implementors<a href="#implementors" class="anchor"></a></h2><div class="item-list" id="implementors-list"></div><script type="text/javascript" src="../../implementors/mmtk/vm/trait.Scanning.js" async></script></section><section id="search" class="content hidden"></section></div></main><div id="rustdoc-vars" data-root-path="../../" data-current-crate="mmtk" data-themes="ayu,dark,light" data-resource-suffix="" data-rustdoc-version="1.59.0 (9d1b2106e 2022-02-23)" ></div>
</body></html>